version: '3.8'

# Windows PC용 Docker Compose 설정
# 사용법: docker-compose -f docker-compose.windows.yml up -d --build

services:
  naver-blog-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: naver-blog-bot
    restart: unless-stopped

    environment:
      - TZ=Asia/Seoul
      - HEADLESS=True
      - DISPLAY=:99
      # 가정용 IP 사용하므로 프록시 비활성화
      - PROXY_ENABLED=False

    volumes:
      # Windows 경로 형식 (상대 경로 사용)
      - ./data:/app/data
      - ./logs:/app/logs
      - ./secrets:/app/secrets:ro
      - ./.env:/app/.env:ro

    # 헬스체크
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

    # 리소스 제한 (Windows용 - Docker Desktop에서 할당한 리소스 내에서)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

    # 로깅 설정
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
